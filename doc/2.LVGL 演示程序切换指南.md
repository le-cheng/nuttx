# LVGL 演示程序切换指南

本文档说明如何在 NuttX LVGL 模拟器中切换不同的演示程序。

## 编译方法

```bash
cd nuttx
cmake -B build -DBOARD_CONFIG=sim:lvgl_fb -GNinja
ninja -C build
```

运行模拟器：
```bash
./build/nuttx
```

默认运行 `widgets` 演示程序。

---

## 默认启动机制

默认配置中，系统启动后直接运行 `lvgldemo_main`，而不是进入 NSH 命令行：

```
CONFIG_INIT_ENTRYPOINT="lvgldemo_main"   # 入口函数
CONFIG_INIT_ARGS="\"widgets\""            # 启动参数
```

这意味着系统启动后会直接运行指定的演示程序，无法在命令行中切换。

---

## 可用的演示程序

| 演示名称 | 配置宏 | 说明 | 依赖 |
|----------|--------|------|------|
| `widgets` | `CONFIG_LV_USE_DEMO_WIDGETS` | 控件展示（默认） | 无 |
| `benchmark` | `CONFIG_LV_USE_DEMO_BENCHMARK` | 性能测试 | widgets + 字体 |
| `music` | `CONFIG_LV_USE_DEMO_MUSIC` | 音乐播放器界面 | 无 |
| `stress` | `CONFIG_LV_USE_DEMO_STRESS` | 压力测试 | 无 |
| `scroll` | `CONFIG_LV_USE_DEMO_SCROLL` | 滚动测试 | 无 |
| `transform` | `CONFIG_LV_USE_DEMO_TRANSFORM` | 变换测试 | MONTSERRAT_18 字体 |
| `keypad_encoder` | `CONFIG_LV_USE_DEMO_KEYPAD_AND_ENCODER` | 键盘/编码器演示 | 无 |
| `flex_layout` | `CONFIG_LV_USE_DEMO_FLEX_LAYOUT` | Flex 布局预览 | 无 |
| `multilang` | `CONFIG_LV_USE_DEMO_MULTILANG` | 多语言演示 | 无 |

---

## 切换演示程序完整流程

以切换到 `music` 演示为例，展示完整操作步骤。

### 步骤 1：进入配置菜单

```bash
cd nuttx/build
ninja menuconfig
```

### 步骤 2：启用目标演示程序

**必须先启用演示程序，否则即使修改了启动参数也无法运行。**

导航路径：
```
Application Configuration
  → Graphics Support
    → Light and Versatile Graphic Library (LVGL)
      → LVGL configuration
        → Demos
```

勾选目标演示：
```
[*] Music player demo
```

### 步骤 3：修改启动参数

导航路径：
```
RTOS Features
  → Tasks and Scheduling
    → Application argument list
```

将值修改为目标演示名称：
```
"music"
```

注意：参数需要用双引号包裹。

### 步骤 4：保存配置并退出

按 `S` 保存，按 `Q` 退出。

### 步骤 5：重新编译运行

```bash
ninja
./nuttx
```

---

## 各演示程序配置要点

### widgets（默认）

无需额外配置，默认已启用。

### music

```
Demos:
  [*] Music player demo

Application argument list: "music"
```

### benchmark

benchmark 有额外依赖，需要启用 widgets 和特定字体：

```
Demos:
  [*] Show some widget          (必须)
  [*] Benchmark your system

Font usage → Montserrat fonts:
  [*] Enable Montserrat 14      (必须)
  [*] Enable Montserrat 24      (必须)

Application argument list: "benchmark"
```

字体配置路径：
```
Application Configuration
  → Graphics Support
    → Light and Versatile Graphic Library (LVGL)
      → LVGL configuration
        → Font usage
          → Montserrat fonts
```

### stress

```
Demos:
  [*] Stress test for LVGL

Application argument list: "stress"
```

### transform

```
Demos:
  [*] Transform test for LVGL

Font usage → Montserrat fonts:
  [*] Enable Montserrat 18      (必须)

Application argument list: "transform"
```

---

## 启用 NSH 命令行模式

默认配置下系统直接运行 lvgldemo，如果想通过 NSH 命令行手动切换演示程序，需要修改启动入口。

### 步骤 1：进入配置菜单

```bash
cd nuttx/build
ninja menuconfig
```

### 步骤 2：修改启动入口为 NSH

导航路径：
```
RTOS Features
  → Tasks and Scheduling
```

修改以下配置：

| 配置项 | 值 |
|--------|-----|
| Application entry point | `nsh_main` |
| Application entry name | `nsh` |
| Application argument list | （留空） |

### 步骤 3：启用需要的演示程序

导航路径：
```
Application Configuration
  → Graphics Support
    → Light and Versatile Graphic Library (LVGL)
      → LVGL configuration
        → Demos
```

勾选需要的演示：
```
[*] Show some widget
[*] Music player demo
[*] Stress test for LVGL
[*] Benchmark your system
```

### 步骤 4：启用依赖（如需要 benchmark）

如果启用了 benchmark，需要同时启用字体：

导航路径：
```
Application Configuration
  → Graphics Support
    → Light and Versatile Graphic Library (LVGL)
      → LVGL configuration
        → Font usage
          → Montserrat fonts
```

勾选：
```
[*] Enable Montserrat 14
[*] Enable Montserrat 24
```

### 步骤 5：保存并重新编译

```bash
ninja
./nuttx
```

### 步骤 6：在 NSH 中运行演示

启动后进入 NSH 命令行，可以运行不同演示：

```bash
NuttShell (NSH) NuttX-12.x.x
nsh> lvgldemo widgets
nsh> lvgldemo music
nsh> lvgldemo benchmark
nsh> lvgldemo stress
```

查看可用演示列表：
```bash
nsh> lvgldemo
```

---

## 两种模式对比

| 特性 | 直接启动模式（默认） | NSH 命令行模式 |
|------|---------------------|----------------|
| 入口函数 | `lvgldemo_main` | `nsh_main` |
| 启动行为 | 直接运行指定演示 | 进入命令行 |
| 切换演示 | 需要重新编译 | 命令行切换 |
| 适用场景 | 产品部署 | 开发调试 |

---

## 常见问题

### Q: 运行时显示 "no demo available" 或演示无法启动

A: 启动参数指定的演示程序未启用。需要在 menuconfig 的 Demos 菜单中勾选对应演示。

### Q: benchmark 编译失败

A: benchmark 依赖 widgets 和特定字体，确保以下都已启用：
- `Show some widget`
- `Benchmark your system`
- `Enable Montserrat 14`
- `Enable Montserrat 24`

### Q: 修改了启动参数但运行的还是 widgets

A: 检查是否启用了目标演示程序。仅修改启动参数不够，必须同时启用对应的演示。

### Q: 想在命令行切换演示但没有 nsh> 提示符

A: 默认配置直接运行 lvgldemo，需要修改入口函数为 `nsh_main` 才能进入命令行。参考"启用 NSH 命令行模式"章节。

### Q: 如何恢复默认配置

A: 删除 build 目录重新配置：
```bash
rm -rf build
cmake -B build -DBOARD_CONFIG=sim:lvgl_fb -GNinja
ninja -C build
```

---

## 配置文件路径

| 文件 | 路径 |
|------|------|
| 板级配置 | `nuttx/boards/sim/sim/sim/configs/lvgl_fb/defconfig` |
| LVGL Kconfig | `apps/graphics/lvgl/Kconfig` |
| 演示注册表 | `apps/graphics/lvgl/lvgl/demos/lv_demos.c` |
| 演示入口 | `apps/examples/lvgldemo/lvgldemo.c` |
| NSH 入口 | `apps/system/nsh/nsh_main.c` |
